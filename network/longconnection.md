## 长连方案

在项目中，像IM聊天、配置立刻生效等需求，要求我们需要维护一个长连通道，让 server 有能力主动给 client 发消息。

在 iOS 中，系统提供的APNS通道，本身就是一种方式。但缺点是，用户可以选择关闭，没法保证触达所有用户。

一般我们需要自己维护一个长连通道，满足上面的业务需求。通过这个通道可以双向收发消息，保证稳定、可靠、快速收发消息。

#### 长连通道

- 双向。都可以 发消息、收消息
- 稳定。打开、关闭 通道，确保通道没有中断
- 可靠。发送、接收数据时，不会丢失、不会乱序、不会被篡改。重试发送
- 快速。发送、接收数据，尽可能快

#### 长连通道方案：
- websocket
- 自己维护 tcp 连接
- 使用 mars 库维护 tcp 连接

#### 具体需求
- 快
  - 建立连接要快
  - 发送消息要快
  - 接收消息要快
- 可靠
  - 不丢失数据，不会被截获、被篡改
  - 对网络变化敏感，弱网环境也能尽快收发送消息
- 





